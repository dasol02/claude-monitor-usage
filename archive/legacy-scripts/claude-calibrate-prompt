#!/bin/bash
# SwiftBarÏö© Calibration ÌîÑÎ°¨ÌîÑÌä∏ Ïä§ÌÅ¨Î¶ΩÌä∏
# ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú ÏûÖÎ†• Î∞õÏïÑÏÑú claude-calibrate Ïã§Ìñâ

# ÌòÑÏû¨ ÏÇ¨Ïö©Îüâ ÌëúÏãú
USAGE_FILE="$HOME/.claude_usage.json"
SESSION_PCT=$(jq -r '.session.percentages.max_percentage // 0' "$USAGE_FILE" 2>/dev/null)
WEEKLY_PCT=$(jq -r '.weekly.percentages.max_percentage // 0' "$USAGE_FILE" 2>/dev/null)

echo "============================================================"
echo "üìä Claude Usage Calibration"
echo "============================================================"
echo ""
echo "Monitor shows:"
echo "  Session: ${SESSION_PCT}%"
echo "  Weekly:  ${WEEKLY_PCT}%"
echo ""
echo "Please run 'claude usage' and enter actual values below."
echo "Format: session weekly (e.g., '3.2 35.7')"
echo "Or just session (e.g., '3.2')"
echo ""
echo -n "Enter values: "

# ÏÇ¨Ïö©Ïûê ÏûÖÎ†• Î∞õÍ∏∞
read -r USER_INPUT

# Í≥µÎ∞±ÏúºÎ°ú Î∂ÑÎ¶¨
read -r SESSION WEEKLY <<< "$USER_INPUT"

# Ïã§Ìñâ
if [ -z "$SESSION" ]; then
    echo ""
    echo "‚ö†Ô∏è  No values entered. Calibration cancelled."
    echo ""
    echo "Press any key to close..."
    read -n 1
    exit 0
fi

echo ""
if [ -n "$WEEKLY" ]; then
    echo "Running: claude-calibrate $SESSION $WEEKLY"
    ~/.local/bin/claude-calibrate "$SESSION" "$WEEKLY"
else
    echo "Running: claude-calibrate $SESSION"
    ~/.local/bin/claude-calibrate "$SESSION"
fi

echo ""
echo "Press any key to close..."
read -n 1
